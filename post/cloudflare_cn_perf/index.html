<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="参考文章:\ncloudflare tunnel 使用 saas 回源，实现优选: https://linux.do/t/topic/122087/16 CF Workers & Pages 设置优选域名: https://www.youtube.com/watch?v=wuanNSAqoHM 准备:\n需要两个域名, 例如 A.com, B.free.com, 这里假设 A.com 是想让别人访问的顶级域名, B.free.com 可以是网上随便申请的免费二级域名 需要一个域名解析支持分国家地区线路的dns解析商, 例如 腾讯云的dns服务 需要开通 Cloudflare SASS 服务, 这里可以绑定国区的paypal, 或者网上搜索的没有钱的虚拟信用卡, 能过验证就行, 不会扣费 前置准备 把 A.com B.free.com 都添加到 cloudflare B.free.com -> ssl/tsl -> 自定义主机名 -> 开通SASS, 自定义主机名需要开通sass, 绑定paypal或者信用卡, 不会扣费 添加一个回退源, 例如 falkback.B.free.com 添加 tunnels 在 Zero Trust -> 网络 -> Tunnels 创建隧道 在需要暴露内网的服务器上安装 cloudflared 在该隧道添加公共主机名 falkback.B.free.com, 服务随便指向服务器上的端口, B.free.com 的 dns 记录会多一条 falkback 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 添加需要暴露的服务, 主机名 www.A.com, 这时候 A.com 的 dns 记录上就多了一条 www 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 www.A.com 是我们想让别人访问的项目, 托管在 cloudflare 上, 国外访问没问题, 但国内一般速度很慢, 甚至访问不了.\n"><title>利用优选域名加速 Cloudflare tunnel 在中国的访问速度</title>
<link rel=canonical href=/post/cloudflare_cn_perf/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="利用优选域名加速 Cloudflare tunnel 在中国的访问速度"><meta property='og:description' content="参考文章:\ncloudflare tunnel 使用 saas 回源，实现优选: https://linux.do/t/topic/122087/16 CF Workers & Pages 设置优选域名: https://www.youtube.com/watch?v=wuanNSAqoHM 准备:\n需要两个域名, 例如 A.com, B.free.com, 这里假设 A.com 是想让别人访问的顶级域名, B.free.com 可以是网上随便申请的免费二级域名 需要一个域名解析支持分国家地区线路的dns解析商, 例如 腾讯云的dns服务 需要开通 Cloudflare SASS 服务, 这里可以绑定国区的paypal, 或者网上搜索的没有钱的虚拟信用卡, 能过验证就行, 不会扣费 前置准备 把 A.com B.free.com 都添加到 cloudflare B.free.com -> ssl/tsl -> 自定义主机名 -> 开通SASS, 自定义主机名需要开通sass, 绑定paypal或者信用卡, 不会扣费 添加一个回退源, 例如 falkback.B.free.com 添加 tunnels 在 Zero Trust -> 网络 -> Tunnels 创建隧道 在需要暴露内网的服务器上安装 cloudflared 在该隧道添加公共主机名 falkback.B.free.com, 服务随便指向服务器上的端口, B.free.com 的 dns 记录会多一条 falkback 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 添加需要暴露的服务, 主机名 www.A.com, 这时候 A.com 的 dns 记录上就多了一条 www 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 www.A.com 是我们想让别人访问的项目, 托管在 cloudflare 上, 国外访问没问题, 但国内一般速度很慢, 甚至访问不了.\n"><meta property='og:url' content='/post/cloudflare_cn_perf/'><meta property='og:site_name' content="Jqtmviyu's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='notes'><meta property='article:tag' content='cloudflare'><meta property='article:published_time' content='2025-05-19T16:21:15+08:00'><meta property='article:modified_time' content='2025-05-19T16:21:15+08:00'><meta name=twitter:title content="利用优选域名加速 Cloudflare tunnel 在中国的访问速度"><meta name=twitter:description content="参考文章:\ncloudflare tunnel 使用 saas 回源，实现优选: https://linux.do/t/topic/122087/16 CF Workers & Pages 设置优选域名: https://www.youtube.com/watch?v=wuanNSAqoHM 准备:\n需要两个域名, 例如 A.com, B.free.com, 这里假设 A.com 是想让别人访问的顶级域名, B.free.com 可以是网上随便申请的免费二级域名 需要一个域名解析支持分国家地区线路的dns解析商, 例如 腾讯云的dns服务 需要开通 Cloudflare SASS 服务, 这里可以绑定国区的paypal, 或者网上搜索的没有钱的虚拟信用卡, 能过验证就行, 不会扣费 前置准备 把 A.com B.free.com 都添加到 cloudflare B.free.com -> ssl/tsl -> 自定义主机名 -> 开通SASS, 自定义主机名需要开通sass, 绑定paypal或者信用卡, 不会扣费 添加一个回退源, 例如 falkback.B.free.com 添加 tunnels 在 Zero Trust -> 网络 -> Tunnels 创建隧道 在需要暴露内网的服务器上安装 cloudflared 在该隧道添加公共主机名 falkback.B.free.com, 服务随便指向服务器上的端口, B.free.com 的 dns 记录会多一条 falkback 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 添加需要暴露的服务, 主机名 www.A.com, 这时候 A.com 的 dns 记录上就多了一条 www 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的 www.A.com 是我们想让别人访问的项目, 托管在 cloudflare 上, 国外访问没问题, 但国内一般速度很慢, 甚至访问不了.\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/avatar.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Jqtmviyu's Blog</a></h1><h2 class=site-description>Let's do this from now on.</h2></div></header><ol class=menu-social><li><a href=https://github.com/jqtmviyu target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://git.081024.xyz/hxx target=_blank title=Gitea rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#b6b6b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gitlab"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-9 7-9-7L6 3l3 7h6l3-7z"/></svg></a></li><li><a href=mailto:jqtmviyu#gmail.com target=_blank title=Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#b6b6b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=/index.xml target=_blank title=Rss rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#b6b6b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#b6b6b6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-home"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12H3l9-9 9 9h-2"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前置准备>前置准备</a></li><li><a href=#添加-tunnels>添加 tunnels</a></li><li><a href=#优选域名>优选域名</a></li><li><a href=#回退域名设置>回退域名设置</a></li><li><a href=#腾讯云设置>腾讯云设置</a></li><li><a href=#worker-设置优选域名>worker 设置优选域名</a></li><li><a href=#pages-设置优选域名>pages 设置优选域名</a></li><li><a href=#通过-tunnel-ssh登录>通过 tunnel ssh登录</a></li><li><a href=#原理>原理</a><ol><li><a href=#自定义主机名和回退域名的正常用法>自定义主机名和回退域名的正常用法</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/notes/ style=background-color:#6b69d6;color:#fff>Notes</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/cloudflare_cn_perf/>利用优选域名加速 Cloudflare tunnel 在中国的访问速度</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025/May/19</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>10 minute read</time></div><div><svg t="1720522640439" class="icon" viewBox="0 0 1024 1024" p-id="5342" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M997 435.6c-28.2-36.7-65.4-81.4-107.4-122.2-54.6-53.2-110.5-95.6-166.1-126.3-71.2-39.2-142-59.1-210.7-59.1s-139.6 19.9-210.7 59.1c-55.5 30.7-111.4 73.1-166.1 126.3-42 40.8-79.3 85.5-107.5 122.1-34.8 45.3-34.8 107.8.0 153.1 28.2 36.7 65.4 81.4 107.4 122.2C190.5 764 246.5 806.4 302 837.1c71.2 39.2 142.1 59.1 210.7 59.1 68.7.0 139.6-19.9 210.8-59 55.5-30.7 111.4-73.1 166.1-126.3 42-40.8 79.3-85.6 107.4-122.2 34.8-45.3 34.8-107.8.0-153.1zm-37.3 99c-66.2 89-243.8 299-446.8 299-57.5.0-117.7-17.1-179-50.8-50.5-27.7-101.7-66.6-152.2-115.6-51.1-49.5-91-99.5-115.7-132.6-10-13.5-10-31.6.0-44.9 66.1-89 243.7-299 446.8-299 57.5.0 117.6 17.1 179 50.8 50.5 27.7 101.7 66.6 152.2 115.6 51.1 49.5 91 99.5 115.7 132.6 9.9 13.4 9.9 31.6.0 44.9z" p-id="5343" fill="#8a8a8a"/><path d="M512 321.7c-105.7.0-191.6 86-191.6 191.6.0 105.7 86 191.6 191.6 191.6s191.6-86 191.6-191.6c0-105.7-86-191.6-191.6-191.6zm0 319.2c-70.3.0-127.6-57.2-127.6-127.6S441.7 385.7 512 385.7s127.6 57.2 127.6 127.6S582.3 640.9 512 640.9z" p-id="5344" fill="#8a8a8a"/></svg>
<time class=article-pageview><span class=waline-pageview-count data-path=/post/cloudflare_cn_perf/>0</span> visits</time></div><div><svg t="1721405452473" class="icon" viewBox="0 0 1024 1024" p-id="2287" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><path d="M853.333333 138.666667H170.666667C130.133334 138.666667 96 172.8 96 213.333333v512C96 765.866666 130.133333 8e2 170.666667 8e2h151.466666V917.333333c0 12.8 8.533333 25.6 19.2 29.866667 4.266667 2.133333 8.533333 2.133333 12.8 2.133333 8.533333.0 17.066667-4.266667 23.466667-10.666666L514.133333 8e2h339.2C893.866666 8e2 928 765.866667 928 725.333333v-512c0-40.533333-34.133333-74.666667-74.666667-74.666666zM864 725.333333c0 6.4-4.266667 10.666667-10.666667 10.666667h-352c-8.533333.0-17.066667 4.266667-23.466666 10.666667l-89.6 93.866666V768c0-17.066667-14.933333-32-32-32h-185.6C164.266667 736 160 731.733333 160 725.333333v-512c0-6.4 4.266667-10.666667 10.666667-10.666666h682.666666c6.4.0 10.666667 4.266667 10.666667 10.666666v512z" fill="#8a8a8a" p-id="2288"/><path d="M512 490.666667H298.666667c-17.066667.0-32 14.933333-32 32s14.933333 32 32 32H512c17.066667.0 32-14.933333 32-32S529.066667 490.666667 512 490.666667zM672 341.333333H298.666667c-17.066667.0-32 14.933333-32 32s14.933333 32 32 32H672c17.066667.0 32-14.933333 32-32s-14.933333-32-32-32z" fill="#8a8a8a" p-id="2289"/></svg>
<time class=article-comment><span class=waline-comment-count data-path=/post/cloudflare_cn_perf/>0</span> comments</time></div></footer></div></header><section class=article-content><p>参考文章:</p><ul><li>cloudflare tunnel 使用 saas 回源，实现优选: <a class=link href=https://linux.do/t/topic/122087/16 target=_blank rel=noopener>https://linux.do/t/topic/122087/16</a></li><li>CF Workers & Pages 设置优选域名: <a class=link href="https://www.youtube.com/watch?v=wuanNSAqoHM" target=_blank rel=noopener>https://www.youtube.com/watch?v=wuanNSAqoHM</a></li></ul><p>准备:</p><ol><li>需要两个域名, 例如 <code>A.com</code>, <code>B.free.com</code>, 这里假设 <code>A.com</code> 是想让别人访问的顶级域名, <code>B.free.com</code> 可以是网上随便申请的免费二级域名</li><li>需要一个域名解析支持分国家地区线路的dns解析商, 例如 腾讯云的dns服务</li><li>需要开通 Cloudflare SASS 服务, 这里可以绑定国区的paypal, 或者网上搜索的没有钱的虚拟信用卡, 能过验证就行, 不会扣费</li></ol><h2 id=前置准备>前置准备</h2><ol><li>把 <code>A.com</code> <code>B.free.com</code> 都添加到 cloudflare</li><li><code>B.free.com -> ssl/tsl -> 自定义主机名 -> 开通SASS</code>, 自定义主机名需要开通sass, 绑定paypal或者信用卡, 不会扣费</li><li>添加一个回退源, 例如 <code>falkback.B.free.com</code></li></ol><h2 id=添加-tunnels>添加 tunnels</h2><ol><li>在 <code>Zero Trust -> 网络 -> Tunnels</code> 创建隧道</li><li>在需要暴露内网的服务器上安装 <code>cloudflared</code></li><li>在该隧道添加公共主机名 <code>falkback.B.free.com</code>, 服务随便指向服务器上的端口, <code>B.free.com</code> 的 dns 记录会多一条 <code>falkback</code> 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的</li><li>添加需要暴露的服务, 主机名 <code>www.A.com</code>, 这时候 <code>A.com</code> 的 dns 记录上就多了一条 <code>www</code> 记录, CNAME 向 cloudflare 分配给我们的免费域名, 并且是开通了小云朵的</li></ol><p><code>www.A.com</code> 是我们想让别人访问的项目, 托管在 cloudflare 上, 国外访问没问题, 但国内一般速度很慢, 甚至访问不了.</p><p>其实有些使用cloudflare托管的国际大厂在国内也开通了业务, 他们的域名在国内解析出来的ip并没有被墙, 速度非常不错, 我们就是要借助这些大厂的域名来访问</p><p>还有的是热心的网友提供的域名, 部署服务扫描在不同运营商下有哪些快的ip, 然后通过api设置不同的解析, 这些就是就是所谓的优选域名</p><h2 id=优选域名>优选域名</h2><p>大厂的域名: 我常用<code>www.apnic.net</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>shopify.com
</span></span><span class=line><span class=cl>time.is
</span></span><span class=line><span class=cl>icook.sh
</span></span><span class=line><span class=cl>icook.tw
</span></span><span class=line><span class=cl>ip.sb
</span></span><span class=line><span class=cl>japan.com
</span></span><span class=line><span class=cl>malaysia.com
</span></span><span class=line><span class=cl>russia.com
</span></span><span class=line><span class=cl>singapore.com
</span></span><span class=line><span class=cl>skk.moe
</span></span><span class=line><span class=cl>www.visa.com.sg
</span></span><span class=line><span class=cl>www.visa.com.hk
</span></span><span class=line><span class=cl>www.visa.com.tw
</span></span><span class=line><span class=cl>www.visa.co.jp
</span></span><span class=line><span class=cl>www.visakorea.com
</span></span><span class=line><span class=cl>www.gco.gov.qa
</span></span><span class=line><span class=cl>www.gov.se
</span></span><span class=line><span class=cl>www.gov.ua
</span></span></code></pre></td></tr></table></div></div><p>网友提供的域名: 这些域名随时可能失效, 用之前最好用 itdog 站点工具tcp ping下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>www.cloudflare-cn.com
</span></span><span class=line><span class=cl>freeyx.cloudflare88.eu.org
</span></span><span class=line><span class=cl>cf.090227.xyz <span class=c1>#三网自适应分流官方优选</span>
</span></span><span class=line><span class=cl>ct.090227.xyz <span class=c1>#电信官方优选</span>
</span></span><span class=line><span class=cl>cmcc.090227.xyz <span class=c1>#移动官方优选</span>
</span></span><span class=line><span class=cl>cfip.xxxxxxxx.tk <span class=c1>#OTC提供维护官方优选</span>
</span></span><span class=line><span class=cl>bestcf.onecf.eu.org <span class=c1>#Mingyu提供维护官方优选</span>
</span></span><span class=line><span class=cl>cf.zhetengsha.eu.org <span class=c1>#小一提供维护官方优选</span>
</span></span><span class=line><span class=cl>acjp2.cloudflarest.link <span class=c1>#KJKKK维护官方优选</span>
</span></span><span class=line><span class=cl>achk.cloudflarest.link <span class=c1>#KJKKK维护官方优选</span>
</span></span><span class=line><span class=cl>xn--b6gac.eu.org
</span></span><span class=line><span class=cl>yx.887141.xyz
</span></span><span class=line><span class=cl>8.889288.xyz
</span></span><span class=line><span class=cl>cfip.1323123.xyz
</span></span><span class=line><span class=cl>cf.515188.xyz
</span></span><span class=line><span class=cl>cf-st.annoy.eu.org
</span></span><span class=line><span class=cl>cf.0sm.com
</span></span><span class=line><span class=cl>cf.877771.xyz
</span></span><span class=line><span class=cl>cf.345673.xyz
</span></span></code></pre></td></tr></table></div></div><h2 id=回退域名设置>回退域名设置</h2><ol><li>添加自定义主机名 <code>www.A.com</code>, 选 txt 验证, 会显示名称为<code>xxx.www.A.com</code>, 值为<code>xxxx</code></li></ol><h2 id=腾讯云设置>腾讯云设置</h2><ol><li>添加 <code>www.A.com</code> 子域名解析, 会提示你在cloudflare上添加一个txt记录来验证, 按要求添加</li><li>在 <code>www.A.com</code> 解析设置里, 添加记录 <code>@</code>, 类型<code>CNAME</code>, 路线<code>境内</code>, 记录值为优选域名, 如<code>www.apnic.net</code></li><li>添加记录 <code>@</code>, 类型<code>CNAME</code>, 路线<code>境外</code>, 记录值为回退域名, 如<code>falkback.B.free.com</code></li><li>上方会有红色报错, 显示未生效, 点击查看详情, 提示要添加两条ns记录到 cloudflare 上 <code>A.com</code> 的dns记录, 原来有一条默认的 <code>www.A.com</code> 的cname记录, 改为ns记录, 再添加另外一条, 稍等一会, 点击重新验证, 会变绿</li><li>添加一条 <code>txt</code> 类型记录, 记录为 回退域名设置里的 <code>xxx</code>, 值为 <code>xxxx</code></li><li>返回上级面板, 最右边的<code>更多 -> 开始解析</code></li><li>等几分钟后, 自定义主机名那里的状态就会变成绿色有效</li><li>如果状态一直没有通过, 重复 <code>回退域名设置-步骤2-删掉重新添加</code>, <code>腾讯云设置-步骤5-修改txt值</code>, 再等几分钟看看</li></ol><div class=mermaid>sequenceDiagram
participant User as 用户
participant DNS as DNS解析
participant OptDomain as 优选域名服务器
participant FallbackDomain as 回退域名服务器
participant CF as Cloudflare边缘节点
participant Tunnel as Cloudflare Tunnel
participant Origin as 源站服务器
User->>DNS: 请求解析 www.A.com
alt 中国境内用户
DNS->>User: 返回优选域名IP (www.apnic.net 等)
Note over User,OptDomain: Host头保持为www.A.com
User->>OptDomain: 请求 (Host: www.A.com)
OptDomain->>CF: 转发请求到Cloudflare边缘
else 中国境外用户
DNS->>User: 返回回退域名IP (fallback.B.free.com)
Note over User,FallbackDomain: Host头保持为www.A.com
User->>FallbackDomain: 请求 (Host: www.A.com)
FallbackDomain->>CF: 通过SAAS服务转发
end
CF->>Tunnel: 根据Host头(www.A.com)识别并路由
Tunnel->>Origin: 转发请求到内部服务
Origin->>Tunnel: 返回响应
Tunnel->>CF: 转发响应
CF->>User: 返回最终响应</div><h2 id=worker-设置优选域名>worker 设置优选域名</h2><ol><li>创建一个 worker 项目</li><li>在cloudflare 上添加 dns 记录, 类型 cname, 名称 www, 目标 <a class=link href=https://www.apnic.net target=_blank rel=noopener>www.apnic.net</a>, 关掉小黄云</li><li>在 workers 路由, 添加路由, 路由为 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a>, worker 选中上面创建的worker</li></ol><h2 id=pages-设置优选域名>pages 设置优选域名</h2><ol><li>创建一个pages 项目</li><li>绑定自定义域 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a>, 等待验证完成后, A.com 的 dns 记录会多一条 cname 记录, 指向 pages 分配给我们的免费域名</li><li>参考 tunnel 的设置, 在腾讯云上添加 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a> 的子域名解析, 同样在cloudflare上添加两条ns记录, 在腾讯云上添加两条 cname 记录, 国内指向 <a class=link href=https://www.apnic.net target=_blank rel=noopener>www.apnic.net</a>, 国外指向 pages 分配给我们的免费域名</li></ol><h2 id=通过-tunnel-ssh登录>通过 tunnel ssh登录</h2><p>在本地电脑上的<code>~/.ssh/config</code> 中添加配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Host 简称
</span></span><span class=line><span class=cl>  HostName tunnel上暴露的公共主机域名
</span></span><span class=line><span class=cl>  Port 一般是默认22
</span></span><span class=line><span class=cl>  User 用户名
</span></span><span class=line><span class=cl>  PreferredAuthentications publickey
</span></span><span class=line><span class=cl>  IdentityFile ~/.ssh/密钥
</span></span><span class=line><span class=cl>  ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h
</span></span></code></pre></td></tr></table></div></div><p>需要安装 <code>cloudflared</code>, 在 ProxyCommand 中调用</p><h2 id=原理>原理</h2><ul><li><p>自定义主机名：</p><ul><li>在 Cloudflare 中配置 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a> 映射到你的 Tunnel，告诉 Cloudflare：「任何 Host 为 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a> 的请求都交给这个服务处理」。</li></ul></li><li><p>SaaS + 回退域名：</p><ul><li>通过 Cloudflare SaaS，将 fallback.B.free.com 设置为 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a> 的"别名"。即使用户访问的是 fallback.B.free.com，只要 Host 头是 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a>，Cloudflare 就能识别并正确路由。</li></ul></li><li><p>Host 头不变是关键：</p><ul><li>不论请求经过哪个域名 IP，到达 Cloudflare 时的 Host 始终是 <a class=link href=https://www.A.com target=_blank rel=noopener>www.A.com</a>，Cloudflare 就能根据这点统一处理。</li></ul></li></ul><blockquote><p>DNS 只是"流量入口"，不是"路由规则"</p><p>真正决定请求怎么走的，是 Cloudflare 的「边缘配置」</p></blockquote><h3 id=自定义主机名和回退域名的正常用法>自定义主机名和回退域名的正常用法</h3><p>假设你是一个建站平台 builder.com：</p><ol><li><p>客户 张三 想用自己的域名 <a class=link href=https://www.zhangsan.com target=_blank rel=noopener>www.zhangsan.com</a>。</p></li><li><p>他把域名 CNAME 到你的平台的 custom.builder.com。</p></li><li><p>你在 Cloudflare 为 <a class=link href=https://www.zhangsan.com target=_blank rel=noopener>www.zhangsan.com</a> 添加 Custom Hostname 记录。</p></li><li><p>设置 Fallback Origin 为 saas-backend.builder.com。</p></li><li><p>当访问 <a class=link href=https://www.zhangsan.com target=_blank rel=noopener>www.zhangsan.com</a>：</p><ul><li>Cloudflare 提供自动证书。</li><li>请求转发到 saas-backend.builder.com。</li><li>后端读取 Host: <a class=link href=https://www.zhangsan.com target=_blank rel=noopener>www.zhangsan.com</a> 来识别用户身份</li></ul></li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/notes/>Notes</a>
<a href=/tags/cloudflare/>Cloudflare</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>LICENSED UNDER CC BY-NC-SA 4.0<br></a></span></section></footer><script src=https://lf26-cdn-tos.bytecdntp.com/cdn/expire-10-y/mermaid/8.14.0/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/git-worktree/><div class=article-details><h2 class=article-title>Git Worktree</h2></div></a></article><article><a href=/post/build_postmarketos/><div class=article-details><h2 class=article-title>pom系统编译</h2></div></a></article><article><a href=/post/install-debian-server-on-xiaomi-phone/><div class=article-details><h2 class=article-title>红米note4x刷成debian服务器</h2></div></a></article><article><a href=/post/add-comment-and-analytics-for-hugo/><div class=article-details><h2 class=article-title>为Hugo博客添加评论和统计功能</h2></div></a></article><article><a href=/post/proxy-forward-reverse-transparent/><div class=article-details><h2 class=article-title>正向|反向|透明代理</h2></div></a></article></div></div></aside><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script type=module>
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
    init({"comment":false,"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.2.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/bmoji","https://unpkg.com/@waline/emojis@1.2.0/weibo"],"highlighter":true,"imageUploader":false,"lang":"en","locale":{"admin":"Admin","placeholder":"Welcome to leave your valuable comments!\nPlease provide a correct email address so that we can send you an email notification when there is a reply.\nDo not post any content unrelated to this article.","reaction0":"Very helpful","reaction1":"Helpful","reaction2":"Average","reaction3":"Not helpful","reaction4":"Confused","reaction5":"Incorrect","reactionTitle":"Was this article helpful to you?"},"meta":["nick","mail"],"pageview":false,"reaction":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_heart_eyes.png","https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_thumbsup.png","https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_zhoumei.png","https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_grievance.png","https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_dizzy_face.png","https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili/bb_slap.png"],"requiredMeta":["nick","mail"],"requiredmetanames":["nick","mail"],"serverURL":"https://waline.081024.xyz"});
</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2025 Jqtmviyu's Blog</section><section class=powerby>build with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>, theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b>, visits <span class="waline-index-count breathe" waline-url=https://waline.081024.xyz data-path=/404.html style=font-weight:700>0</span></section><script>(async()=>{let e=document.querySelector(".waline-index-count"),s=e.getAttribute("waline-url"),o=document.querySelectorAll(".waline-pageview-count"),a=Array.from(o).map(e=>e.getAttribute("data-path")),i=document.querySelectorAll(".waline-comment-count"),r=Array.from(i).map(e=>e.getAttribute("data-path"));function c(e){let t=s+"/api/article/?path=";return e.forEach((e,n)=>{t+=n===0?e:","+e}),fetch(t).then(e=>e.json()).then(e=>{if(e.errno==0)return e.data.map(e=>e.time);throw new Error("获取失败")}).catch(e=>new Promise((t,n)=>{n(e)}))}function l(e){let t={path:e};return fetch(`${s}/api/article`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{if(e.errno==0)return e.data[0].time;throw new Error("获取失败")}).catch(e=>new Promise((t,n)=>{n(e)}))}function d(e){let t=s+"/api/comment?type=count&lang=en&url=";return e.forEach((e,n)=>{t+=n===0?e:","+e}),fetch(t).then(e=>e.json()).then(e=>{if(e.errno==0)return e.data;throw new Error("获取失败")}).catch(e=>new Promise((t,n)=>{n(e)}))}(window.location.pathname=="/"||window.location.pathname.includes("/page/"))&&(c(a).then(e=>{e.forEach((e,t)=>{o[t].innerText=e})}),d(r).then(e=>{console.log("commentCounts",e),e.forEach((e,t)=>{i[t].innerText=e})})),window.location.pathname.includes("/post/")&&(l(a[0]).then(e=>{o[0].innerText=e}),d(r).then(e=>{e.forEach((e,t)=>{i[t].innerText=e})}));let t=localStorage.getItem("indexCount"),n=localStorage.getItem("lastVisitTime");!!n==!1&&l("/").then(t=>{localStorage.setItem("indexCount",t),localStorage.setItem("lastVisitTime",Date.now()),e.innerHTML=t}),!!n&&!!t&&Date.now()-n<36e5&&(t=localStorage.getItem("indexCount"),e.innerHTML=t),!!n&&Date.now()-n>=36e5&&c(["/"]).then(n=>{t=n[0],localStorage.setItem("indexCount",t),localStorage.setItem("lastVisitTime",Date.now()),e.innerHTML=t}),setInterval(()=>{(new Date).getSeconds()%2===0?e.style.color="red":e.style.color=""},1e3)})()</script><style>.wl-action[title=GIF]{display:none}footer.site-footer{padding-bottom:20px}</style></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>