<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="n2n 参考: https://bugxia.com/2396.html https://www.jianshu.com/p/559c1e582724 https://github.com/LomotHo/n2n-releases 服务器安装 centos 1 2 3 4 # RPM安装 yum install libzstd -y wget https://github.com/ntop/n2n/releases/download/3.0/n2n-3.0.0-1038.x86_64.rpm rpm -i n2n-3.0.0-1038.x86_64.rpm 启动服务器 1 2 3 启动服务端 #实际使用时，可以去掉 -f 参数，使其后台运行 supernode -p 端口"><title>n2n部署</title><link rel=canonical href=/p/n2n-deploy/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="n2n部署"><meta property="og:description" content="n2n 参考: https://bugxia.com/2396.html https://www.jianshu.com/p/559c1e582724 https://github.com/LomotHo/n2n-releases 服务器安装 centos 1 2 3 4 # RPM安装 yum install libzstd -y wget https://github.com/ntop/n2n/releases/download/3.0/n2n-3.0.0-1038.x86_64.rpm rpm -i n2n-3.0.0-1038.x86_64.rpm 启动服务器 1 2 3 启动服务端 #实际使用时，可以去掉 -f 参数，使其后台运行 supernode -p 端口"><meta property="og:url" content="/p/n2n-deploy/"><meta property="og:site_name" content="Jqtmviyu's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="network"><meta property="article:published_time" content="2022-12-18T17:02:27+08:00"><meta property="article:modified_time" content="2022-12-18T17:02:27+08:00"><meta name=twitter:title content="n2n部署"><meta name=twitter:description content="n2n 参考: https://bugxia.com/2396.html https://www.jianshu.com/p/559c1e582724 https://github.com/LomotHo/n2n-releases 服务器安装 centos 1 2 3 4 # RPM安装 yum install libzstd -y wget https://github.com/ntop/n2n/releases/download/3.0/n2n-3.0.0-1038.x86_64.rpm rpm -i n2n-3.0.0-1038.x86_64.rpm 启动服务器 1 2 3 启动服务端 #实际使用时，可以去掉 -f 参数，使其后台运行 supernode -p 端口"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/avatar.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Jqtmviyu's Blog</a></h1><h2 class=site-description>It's never too late to learn.</h2></div></header><ol class=social-menu><li><a href=https://github.com/jqtmviyu target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:jqtmviyu@gmail.com target=_blank title=Mail rel=me><!doctype html><svg t="1640862754493" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1236" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style/></defs><path d="M858.656 192H165.344C109.472 192 64 237.44 64 293.312v469.376C64 818.56 109.472 864 165.344 864h693.312C914.528 864 960 818.56 960 762.688V293.312C960 237.44 914.528 192 858.656 192zm0 608H165.344C144.736 8e2 128 783.264 128 762.688V293.312C128 272.736 144.736 256 165.344 256h684.544L542.4 535.808c-14.592 14.56-38.272 14.528-54.752-1.792L243.392 327.264C229.856 315.84 209.664 317.504 198.272 331.008c-11.424 13.472-9.76 33.664 3.744 45.088l242.304 204.96c19.904 19.904 46.048 29.792 72.032 29.792 25.632.0 51.136-9.632 70.176-28.736L896 300.544v462.144C896 783.264 879.264 8e2 858.656 8e2z" p-id="1237" fill="#b6b6b6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#服务器安装>服务器安装</a></li><li><a href=#启动服务器>启动服务器</a></li><li><a href=#服务器端口放行>服务器端口放行</a></li><li><a href=#客户端组建n2n虚拟局域网>客户端组建N2N虚拟局域网</a></li><li><a href=#安装tuntap>安装tuntap</a></li><li><a href=#macos-设置开机启动项>macos 设置开机启动项</a></li><li><a href=#linux客户端设置自启动>linux客户端设置自启动</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/tools/>tools</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/n2n-deploy/>n2n部署</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2022/Dec/18</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><h1 id=n2n>n2n</h1><p>参考:<br><a class=link href=https://bugxia.com/2396.html target=_blank rel=noopener>https://bugxia.com/2396.html</a><br><a class=link href=https://www.jianshu.com/p/559c1e582724 target=_blank rel=noopener>https://www.jianshu.com/p/559c1e582724</a><br><a class=link href=https://github.com/LomotHo/n2n-releases target=_blank rel=noopener>https://github.com/LomotHo/n2n-releases</a></p><h2 id=服务器安装>服务器安装</h2><ul><li>centos</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># RPM安装</span>
</span></span><span class=line><span class=cl>yum install libzstd -y  
</span></span><span class=line><span class=cl>wget https://github.com/ntop/n2n/releases/download/3.0/n2n-3.0.0-1038.x86_64.rpm  
</span></span><span class=line><span class=cl>rpm -i n2n-3.0.0-1038.x86_64.rpm
</span></span></code></pre></td></tr></table></div></div><h2 id=启动服务器>启动服务器</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>启动服务端
</span></span><span class=line><span class=cl><span class=c1>#实际使用时，可以去掉 -f 参数，使其后台运行</span>
</span></span><span class=line><span class=cl>supernode -p 端口 -f
</span></span></code></pre></td></tr></table></div></div><ul><li>服务端（Supernode）附加参数<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-p 端口 <span class=p>|</span> Supernode监听端口，默认 <span class=m>7654</span>
</span></span><span class=line><span class=cl>-F federation名称 <span class=p>|</span> supernode federation名称，默认为 *Federation
</span></span><span class=line><span class=cl>-l 主机:端口 <span class=p>|</span> 和 -F 配合，已知的一台Supernode地址和端口
</span></span><span class=line><span class=cl>-M <span class=p>|</span> 关闭非用户名密码认证的群组的MAC和IP地址欺骗保护功能
</span></span><span class=line><span class=cl>-V 文本 <span class=p>|</span> 自定义字符串（最长19位），用于在管理输出日志中展示
</span></span><span class=line><span class=cl>-c 组名称配置文件路径 <span class=p>|</span> 该配置文件中包含允许使用的组名称
</span></span><span class=line><span class=cl>-a IP段 <span class=p>|</span> 用于自动分配IP，格式如 -a 192.168.0.0-192.168.255.0/24
</span></span><span class=line><span class=cl>-t 端口 <span class=p>|</span> 用于管理supernode
</span></span><span class=line><span class=cl>--management_password 文本 <span class=p>|</span> 管理端的密码
</span></span><span class=line><span class=cl>-v <span class=p>|</span> 输出更多日志
</span></span></code></pre></td></tr></table></div></div></li></ul><ul><li><p>设置开机启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 修改配置文件</span>
</span></span><span class=line><span class=cl>sudo vim /etc/n2n/supernode.conf
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>-p<span class=o>=</span>端口
</span></span><span class=line><span class=cl><span class=c1># 服务端没有密码，为了避免被白嫖，添加组名称配置文件，一行一个</span>
</span></span><span class=line><span class=cl>-c<span class=o>=</span>/home/n2n/community.list
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> supernode
</span></span><span class=line><span class=cl>sudo systemctl start supernode
</span></span><span class=line><span class=cl>sudo systemctl status supernode  
</span></span><span class=line><span class=cl>journalctl -f -u supernode 
</span></span><span class=line><span class=cl><span class=c1># journalctl 查看日志</span>
</span></span><span class=line><span class=cl><span class=c1># -f 实时最新</span>
</span></span><span class=line><span class=cl><span class=c1># -u 指定服务</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=服务器端口放行>服务器端口放行</h2><ul><li>腾讯云的防火墙</li><li>若服务器开启了如iptables\firewalld\ufw等防火墙，需要放行supernode所设置的端口，否则客户端无法连接</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#firewalld </span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --add-port<span class=o>=</span>9527/udp --permanent
</span></span><span class=line><span class=cl>firewall-cmd --reload
</span></span><span class=line><span class=cl><span class=c1>#iptables</span>
</span></span><span class=line><span class=cl>iptables -I INPUT -p udp --dport <span class=m>9527</span> -j ACCEPT
</span></span><span class=line><span class=cl>service iptables save
</span></span><span class=line><span class=cl>service iptables restart
</span></span><span class=line><span class=cl><span class=c1>#ufw</span>
</span></span><span class=line><span class=cl>ufw allow 9527/udp
</span></span></code></pre></td></tr></table></div></div><p>centos7 默认是firewall</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl>systemctl status firewalld
</span></span><span class=line><span class=cl><span class=c1># 或者</span>
</span></span><span class=line><span class=cl>firewall-cmd --state
</span></span><span class=line><span class=cl><span class=c1>#　查看所有开放端口</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --list-ports
</span></span><span class=line><span class=cl><span class=c1># 禁用端口</span>
</span></span><span class=line><span class=cl>firewall-cmd --zone<span class=o>=</span>public --remove-port<span class=o>=</span>5672/tcp --permanent  <span class=c1>#关闭5672端口</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=客户端组建n2n虚拟局域网>客户端组建N2N虚拟局域网</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo edge -a 局域网ip -c n2n组名 -l <span class=o>[</span>公网ip<span class=o>]</span>:公网端口 -f
</span></span></code></pre></td></tr></table></div></div><p>参数说明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-a &lt;mode:address&gt;        <span class=p>|</span> n2n网卡的ip地址，即本机的n2n的ip。直接填写IP或者使用 DHCP <span class=s1>&#39;-r -a dhcp:0.0.0.0&#39;</span>
</span></span><span class=line><span class=cl>-c &lt;community&gt;           <span class=p>|</span> n2n组，只有相同组的edge之间才能进行通讯
</span></span><span class=line><span class=cl>-k &lt;encrypt key&gt;         <span class=p>|</span> edge的加密密码
</span></span><span class=line><span class=cl>-s &lt;netmask&gt;             <span class=p>|</span> 子网掩码 可选 <span class=o>(</span>255.255.255.0<span class=o>)</span>.
</span></span><span class=line><span class=cl>-l &lt;supernode host:port&gt; <span class=p>|</span> supernode的ip和端口
</span></span><span class=line><span class=cl>-i &lt;reg_interval&gt;        <span class=p>|</span> 注册时间间隔，用于NAT打洞<span class=o>(</span>默认为20秒<span class=o>)</span>
</span></span><span class=line><span class=cl>-L &lt;reg_ttl&gt;             <span class=p>|</span> 当通过超级节点UDP NAT打洞时，注册数据包的TTL<span class=o>(</span>默认0不设置<span class=o>)</span>
</span></span><span class=line><span class=cl>-p &lt;<span class=nb>local</span> port&gt;          <span class=p>|</span> 固定本地UDP端口
</span></span><span class=line><span class=cl>-u &lt;UID&gt;                 <span class=p>|</span> 如果不想用root来运行edge，则可指定本机账号的uid，windows下可忽略
</span></span><span class=line><span class=cl>-g &lt;GID&gt;                 <span class=p>|</span> 如果不想用root来运行edge，则可指定本机账号的groupid，windows下可忽略
</span></span><span class=line><span class=cl>-f                       <span class=p>|</span> 带-f时前台运行，不添加-f 参数时作为守护进程运行
</span></span><span class=line><span class=cl>-m &lt;MAC address&gt;         <span class=p>|</span> n2n虚拟网卡的MAC地址，默认随机设置
</span></span><span class=line><span class=cl>                         <span class=p>|</span> eg. -m 01:02:03:04:05:06
</span></span><span class=line><span class=cl>-M &lt;mtu&gt;                 <span class=p>|</span> MTU 值，默认1290
</span></span><span class=line><span class=cl>-r                       <span class=p>|</span> 启用数据转发功能，当需要访问该设备的局域网时需要设置
</span></span><span class=line><span class=cl>-A1                      <span class=p>|</span> 禁用载荷加密。不能与key 同时使用<span class=o>(</span>默认为Twofish<span class=o>)</span>。
</span></span><span class=line><span class=cl>-A2 ... -A5 or -A        <span class=p>|</span> 选择有效载荷加密的密码<span class=o>(</span>和-k一起用<span class=o>)</span>，需要一个密钥:-A2 <span class=o>=</span> Twofish<span class=o>(</span>默认<span class=o>)</span>，
</span></span><span class=line><span class=cl>                         <span class=p>|</span> -A3 or -A <span class=o>(</span>deprecated<span class=o>)</span> <span class=o>=</span> AES-CBC, -A5 <span class=o>=</span> Speck-CTR.
</span></span><span class=line><span class=cl>-H                       <span class=p>|</span> Enable full header encryption. Requires supernode with fixed community.
</span></span><span class=line><span class=cl>-z1 ... -z2 or -z        <span class=p>|</span> Enable compression <span class=k>for</span> outgoing data packets: -z1 or -z <span class=o>=</span> lzo1x <span class=o>(</span><span class=nv>default</span><span class=o>=</span>disabled<span class=o>)</span>.
</span></span><span class=line><span class=cl>-E                       <span class=p>|</span> 接受多播MAC地址<span class=o>(</span>默认<span class=o>=</span>drop<span class=o>)</span>
</span></span><span class=line><span class=cl>-S                       <span class=p>|</span> 不要连接P2P ，总是使用超级节点转发数据
</span></span><span class=line><span class=cl>-n &lt;cidr:gateway&gt;        <span class=p>|</span> 通过gw路由IPv4网络。使用0.0.0.0/0作为默认gw。可多次设置。
</span></span><span class=line><span class=cl>-v                       <span class=p>|</span> 详细日志
</span></span><span class=line><span class=cl>-t &lt;port&gt;                <span class=p>|</span> 管理UDP端口<span class=o>(</span>用于机器上的多个edges<span class=o>)</span>。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>环境变量:
</span></span><span class=line><span class=cl>N2N_KEY                <span class=p>|</span> 加密密钥<span class=o>(</span>ASCII<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安装tuntap>安装tuntap</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>brew tap happynclient/taps
</span></span><span class=line><span class=cl>brew install tuntap --cask
</span></span></code></pre></td></tr></table></div></div><p>.查看系统信息，您会看到一个名为 tap0的虚拟网卡
sudo ifconfig</p><h2 id=macos-设置开机启动项>macos 设置开机启动项</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在 /Library/LaunchDaemons 新增文件 lomotho.n2n-edge.plist，用于 launchd 控制的开机自启（类似 systemd）</span>
</span></span><span class=line><span class=cl><span class=c1># RunAtLoad 开机时是否运行</span>
</span></span><span class=line><span class=cl><span class=c1># KeepAlive 是否需要一直运行</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>&lt;?xml <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nv>encoding</span><span class=o>=</span><span class=s2>&#34;UTF-8&#34;</span>?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE plist PUBLIC <span class=s2>&#34;-//Apple//DTD PLIST 1.0//EN&#34;</span> <span class=s2>&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;plist <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span>&gt;
</span></span><span class=line><span class=cl>  &lt;dict&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;KeepAlive&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;true/&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;RunAtLoad&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;true/&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;Label&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;string&gt;lomotho.n2n.edge&lt;/string&gt;
</span></span><span class=line><span class=cl>    &lt;key&gt;ProgramArguments&lt;/key&gt;
</span></span><span class=line><span class=cl>    &lt;array&gt;
</span></span><span class=line><span class=cl>      &lt;string&gt;/usr/local/bin/edge&lt;/string&gt;
</span></span><span class=line><span class=cl>      &lt;string&gt;/usr/local/etc/n2n/edge.conf&lt;/string&gt;
</span></span><span class=line><span class=cl>    &lt;/array&gt;
</span></span><span class=line><span class=cl>  &lt;/dict&gt;
</span></span><span class=line><span class=cl>&lt;/plist&gt;
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 客户端配置文件</span>
</span></span><span class=line><span class=cl><span class=c1># /usr/local/etc/n2n/edge.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#         The configuration file is similar to the command line, with one option per line. An equal</span>
</span></span><span class=line><span class=cl><span class=c1>#        sign &#39;=&#39; should be used between key and value. Example: -c=mynetwork or --community=mynetwork</span>
</span></span><span class=line><span class=cl><span class=c1>#        This file contains a basic configuration example, please refer to the help (-h) for the full</span>
</span></span><span class=line><span class=cl><span class=c1>#        list of available options.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -d|--tun-device</span>
</span></span><span class=line><span class=cl><span class=c1>#        Specifies the name of the TUN interface. </span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#	-d=n2n0</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -c|--community</span>
</span></span><span class=line><span class=cl><span class=c1>#        Specifies the n2n community name the edge belongs to.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>-c<span class=o>=</span>xxx
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -k</span>
</span></span><span class=line><span class=cl><span class=c1>#        Sets the encryption key (ASCII). The environment variable N2N_KEY=&lt;key&gt; can also be used. </span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#	-k=mypassword</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -m</span>
</span></span><span class=line><span class=cl><span class=c1>#        Specified the MAC address for the TAP interface (random otherwise).</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># -m=DE:AD:BE:EF:99:99</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -a</span>
</span></span><span class=line><span class=cl><span class=c1>#        Sets the interface address. For DHCP use &#39;-r -a dhcp:0.0.0.0&#39;.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>-a<span class=o>=</span>x.x.x.x
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -p</span>
</span></span><span class=line><span class=cl><span class=c1>#        Sets the local UDP port to a fixed port.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># -p=50001</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#       -l|--supernode-list</span>
</span></span><span class=line><span class=cl><span class=c1>#        Specifies the supernode IP and port.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>-l<span class=o>=</span>x.x.x.x:x
</span></span><span class=line><span class=cl><span class=c1># 访问局域网其他设置</span>
</span></span><span class=line><span class=cl>-r
</span></span><span class=line><span class=cl><span class=c1># -Z1为LZO(1x)压缩 -Z2为ZSTD压缩，默认没有</span>
</span></span><span class=line><span class=cl>-Z2
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 开启服务</span>
</span></span><span class=line><span class=cl>launchctl load /Library/LaunchDaemons/lomotho.n2n.edge.plist
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 关闭服务</span>
</span></span><span class=line><span class=cl>launchctl unload /Library/LaunchDaemons/lomotho.n2n.edge.plist
</span></span></code></pre></td></tr></table></div></div><h2 id=linux客户端设置自启动>linux客户端设置自启动</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /etc/n2n/edge.conf
</span></span><span class=line><span class=cl><span class=o>======</span>
</span></span><span class=line><span class=cl>-c<span class=o>=</span>组织名
</span></span><span class=line><span class=cl>-a<span class=o>=</span>内网地址
</span></span><span class=line><span class=cl>-l<span class=o>=</span>节点公网地址:端口
</span></span><span class=line><span class=cl><span class=o>======</span>
</span></span><span class=line><span class=cl><span class=c1># 设置自启服务</span>
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> edge
</span></span><span class=line><span class=cl>sudo systemctl start edge
</span></span><span class=line><span class=cl>sudo systemctl status edge  
</span></span><span class=line><span class=cl>journalctl -f -u edge 
</span></span><span class=line><span class=cl><span class=c1># journalctl 查看日志</span>
</span></span><span class=line><span class=cl><span class=c1># -f 实时最新</span>
</span></span><span class=line><span class=cl><span class=c1># -u 指定服务</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/network/>network</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>LICENSED UNDER CC BY-NC-SA 4.0<br></a></span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/obsidian_instead_typora/><div class=article-details><h2 class=article-title>2023年, Obsidian完全可以替代Typora了</h2></div></a></article><article><a href=/p/vim_mouse_mode/><div class=article-details><h2 class=article-title>Vim取消鼠标移动光标模式</h2></div></a></article><article><a href=/p/vscode_vimmode_switch_im/><div class=article-details><h2 class=article-title>Vscode Vim模式下切换输入法状态</h2></div></a></article><article><a href=/p/vscode_remote_rember_password/><div class=article-details><h2 class=article-title>Vscode Remote记住密码</h2></div></a></article><article><a href=/p/mac-install_navidrome/><div class=article-details><h2 class=article-title>mac安装Navidrome</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2017 -
2023 Jqtmviyu's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>